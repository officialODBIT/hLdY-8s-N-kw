<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Editor</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --background-color: #f5f5f5;
            --editor-bg: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --success-color: #2ecc71;
            --toolbar-height: 40px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .editor-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-color);
        }

        .editor-wrapper {
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            flex-grow: 1;
            background-color: var(--editor-bg);
        }

        .toolbar {
            display: flex;
            background-color: #f8f9fa;
            border-bottom: 1px solid var(--border-color);
            padding: 8px;
            flex-wrap: wrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .toolbar-group {
            display: flex;
            margin-right: 15px;
            align-items: center;
        }

        .toolbar-group:last-child {
            margin-right: 0;
        }

        .toolbar-divider {
            width: 1px;
            background-color: var(--border-color);
            margin: 0 10px;
            height: 24px;
        }

        .btn {
            background-color: transparent;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .btn.active {
            background-color: rgba(52, 152, 219, 0.2);
            color: var(--primary-color);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 120px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            z-index: 1;
            margin-top: 2px;
        }

        .dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .dropdown-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .color-picker {
            width: 20px;
            height: 20px;
            border: none;
            padding: 0;
            cursor: pointer;
            border-radius: 3px;
        }

        select.formatting-dropdown {
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: white;
            font-size: 14px;
            cursor: pointer;
        }

        .editor-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            min-height: 300px;
            outline: none;
            line-height: 1.6;
            font-size: 16px;
            font-family: "Book Antiqua", Palatino, serif;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 8px 16px;
            background-color: #f8f9fa;
            border-top: 1px solid var(--border-color);
            font-size: 12px;
            color: #666;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .primary-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .primary-btn:hover {
            background-color: var(--secondary-color);
        }

        .secondary-btn {
            background-color: white;
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .secondary-btn:hover {
            background-color: #f0f0f0;
        }

        /* Print styling */
        @media print {
            .toolbar, .action-buttons, .editor-header, .status-bar {
                display: none !important;
            }
            
            .editor-wrapper {
                border: none;
                box-shadow: none;
            }
            
            .editor-content {
                padding: 0;
            }
            
            body, .container {
                padding: 0;
                margin: 0;
            }
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background-color: var(--success-color);
            color: white;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* File name input */
        .file-name-input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            width: 200px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            min-width: 300px;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            margin-bottom: 15px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .word-count {
            margin-right: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="editor-header">
            <h1 class="editor-title">Advanced Text Editor</h1>
            <input type="text" class="file-name-input" id="fileName" placeholder="untitled.txt" value="document.txt">
        </div>

        <div class="editor-wrapper">
            <div class="toolbar">
                <div class="toolbar-group">
                    <button id="undoBtn" class="btn" title="Undo">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 10h10a5 5 0 0 1 5 5v2"></path>
                            <path d="m3 10 5-5"></path>
                            <path d="m3 10 5 5"></path>
                        </svg>
                    </button>
                    <button id="redoBtn" class="btn" title="Redo">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10H11a5 5 0 0 0-5 5v2"></path>
                            <path d="m21 10-5-5"></path>
                            <path d="m21 10-5 5"></path>
                        </svg>
                    </button>
                </div>

                <div class="toolbar-divider"></div>

                <div class="toolbar-group">
                    <select id="formatBlock" class="formatting-dropdown">
                        <option value="p">Paragraph</option>
                        <option value="h1">Heading 1</option>
                        <option value="h2">Heading 2</option>
                        <option value="h3">Heading 3</option>
                        <option value="h4">Heading 4</option>
                        <option value="pre">Preformatted</option>
                        <option value="blockquote">Blockquote</option>
                    </select>
                </div>

                <div class="toolbar-divider"></div>

                <div class="toolbar-group">
                    <button id="boldBtn" class="btn" title="Bold">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                            <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                        </svg>
                    </button>
                    <button id="italicBtn" class="btn" title="Italic">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="19" y1="4" x2="10" y2="4"></line>
                            <line x1="14" y1="20" x2="5" y2="20"></line>
                            <line x1="15" y1="4" x2="9" y2="20"></line>
                        </svg>
                    </button>
                    <button id="underlineBtn" class="btn" title="Underline">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"></path>
                            <line x1="4" y1="21" x2="20" y2="21"></line>
                        </svg>
                    </button>
                    <button id="strikeBtn" class="btn" title="Strikethrough">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 9V6a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2v3"></path>
                            <path d="M20 12H4"></path>
                            <path d="M11 12a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-3"></path>
                        </svg>
                    </button>
                </div>

                <div class="toolbar-divider"></div>

                <div class="toolbar-group">
                    <button id="alignLeftBtn" class="btn" title="Align Left">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="12" x2="15" y2="12"></line>
                            <line x1="3" y1="18" x2="18" y2="18"></line>
                        </svg>
                    </button>
                    <button id="alignCenterBtn" class="btn" title="Align Center">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="6" y1="12" x2="18" y2="12"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                    <button id="alignRightBtn" class="btn" title="Align Right">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="9" y1="12" x2="21" y2="12"></line>
                            <line x1="6" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                    <button id="alignJustifyBtn" class="btn" title="Justify">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                </div>

                <div class="toolbar-divider"></div>

                <div class="toolbar-group">
                    <button id="listUlBtn" class="btn" title="Bulleted List">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="8" y1="6" x2="21" y2="6"></line>
                            <line x1="8" y1="12" x2="21" y2="12"></line>
                            <line x1="8" y1="18" x2="21" y2="18"></line>
                            <line x1="3" y1="6" x2="3.01" y2="6"></line>
                            <line x1="3" y1="12" x2="3.01" y2="12"></line>
                            <line x1="3" y1="18" x2="3.01" y2="18"></line>
                        </svg>
                    </button>
                    <button id="listOlBtn" class="btn" title="Numbered List">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="10" y1="6" x2="21" y2="6"></line>
                            <line x1="10" y1="12" x2="21" y2="12"></line>
                            <line x1="10" y1="18" x2="21" y2="18"></line>
                            <path d="M4 6h1v4"></path>
                            <path d="M4 10h2"></path>
                            <path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"></path>
                        </svg>
                    </button>
                    <button id="indentBtn" class="btn" title="Indent">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                            <line x1="14" y1="9" x2="19" y2="9"></line>
                            <line x1="14" y1="15" x2="19" y2="15"></line>
                        </svg>
                    </button>
                    <button id="outdentBtn" class="btn" title="Outdent">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                            <line x1="5" y1="9" x2="10" y2="9"></line>
                            <line x1="5" y1="15" x2="10" y2="15"></line>
                        </svg>
                    </button>
                </div>

                <div class="toolbar-divider"></div>

                <div class="toolbar-group">
                    <button id="linkBtn" class="btn" title="Insert Link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                    </button>
                    <button id="imageBtn" class="btn" title="Insert Image">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                    </button>
                    <button id="tableBtn" class="btn" title="Insert Table">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="3" y1="9" x2="21" y2="9"></line>
                            <line x1="3" y1="15" x2="21" y2="15"></line>
                            <line x1="9" y1="3" x2="9" y2="21"></line>
                            <line x1="15" y1="3" x2="15" y2="21"></line>
                        </svg>
                    </button>
                </div>

                <div class="toolbar-divider"></div>

                <div class="toolbar-group">
                    <div class="dropdown">
                        <button id="fontColorBtn" class="btn" title="Font Color">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="m17 8-5 7-5-7h10z"></path>
                                <path d="M12 22v-4"></path>
                            </svg>
                            <input type="color" id="fontColor" class="color-picker">
                        </button>
                    </div>
                    <div class="dropdown">
                        <button id="bgColorBtn" class="btn" title="Background Color">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 3h10v10H11V3z"></path>
                                <path d="m3 21 8-8"></path>
                                <path d="M15 11v4h4"></path>
                                <path d="m5 11 4 4"></path>
                                <path d="m19 15-4 4"></path>
                            </svg>
                            <input type="color" id="bgColor" class="color-picker">
                        </button>
                    </div>
                </div>

                <div class="toolbar-divider"></div>

                <div class="toolbar-group">
                    <button id="codeBtn" class="btn" title="Code Format">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="16 18 22 12 16 6"></polyline>
                            <polyline points="8 6 2 12 8 18"></polyline>
                        </svg>
                    </button>
                    <button id="clearFormatBtn" class="btn" title="Clear Formatting">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2H2v10h10V2z"></path>
                            <path d="M16 16h6v-6h-6v6z"></path>
                            <path d="M20 12v4h-4"></path>
                            <path d="M4 12v8h8"></path>
                            <path d="M12 20h4"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <div id="editor" class="editor-content" contenteditable="true"></div>

            <div class="status-bar">
                <div class="statistics">
                    <span id="wordCount" class="word-count">0 words</span>
                    <span id="charCount">0 characters</span>
                </div>
                <div class="editor-mode">
                    <span id="editorMode">Editing</span>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button id="saveBtn" class="action-btn primary-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                    <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
                Save to Device
            </button>
            <button id="printBtn" class="action-btn secondary-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 6 2 18 2 18 9"></polyline>
                    <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                    <rect x="6" y="14" width="12" height="8"></rect>
                </svg>
                Print
            </button>
        </div>
    </div>

    <!-- Link Modal -->
    <div id="linkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Insert Link</h3>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 10px;">
                    <label for="linkText">Text</label>
                    <input type="text" id="linkText" class="file-name-input" style="width: 100%;">
                </div>
                <div>
                    <label for="linkUrl">URL</label>
                    <input type="text" id="linkUrl" class="file-name-input" style="width: 100%;" placeholder="https://">
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelLinkBtn" class="action-btn secondary-btn">Cancel</button>
                <button id="insertLinkBtn" class="action-btn primary-btn">Insert</button>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Insert Image</h3>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 10px;">
                    <label for="imageUrl">Image URL</label>
                    <input type="text" id="imageUrl" class="file-name-input" style="width: 100%;" placeholder="https://">
                </div>
                <div>
                    <label for="imageAlt">Alt Text</label>
                    <input type="text" id="imageAlt" class="file-name-input" style="width: 100%;">
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelImageBtn" class="action-btn secondary-btn">Cancel</button>
                <button id="insertImageBtn" class="action-btn primary-btn">Insert</button>
            </div>
        </div>
    </div>

    <!-- Table Modal -->
    <div id="tableModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Insert Table</h3>
            </div>
            <div class="modal-body">
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label for="tableRows">Rows</label>
                        <input type="number" id="tableRows" class="file-name-input" style="width: 100%;" value="3" min="1" max="20">
                    </div>
                    <div style="flex: 1;">
                        <label for="tableCols">Columns</label>
                        <input type="number" id="tableCols" class="file-name-input" style="width: 100%;" value="3" min="1" max="10">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelTableBtn" class="action-btn secondary-btn">Cancel</button>
                <button id="insertTableBtn" class="action-btn primary-btn">Insert</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">Document saved</div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const editor = document.getElementById('editor');
            const wordCount = document.getElementById('wordCount');
            const charCount = document.getElementById('charCount');
            const saveBtn = document.getElementById('saveBtn');
            const printBtn = document.getElementById('printBtn');
            const fileName = document.getElementById('fileName');
            const notification = document.getElementById('notification');
            
            // Initialize editor with default content
            editor.innerHTML = '<p>This is a specialized document editor for ODBIT case documents! Start Typing.</p>';
            
            // Format buttons
            const boldBtn = document.getElementById('boldBtn');
            const italicBtn = document.getElementById('italicBtn');
            const underlineBtn = document.getElementById('underlineBtn');
            const strikeBtn = document.getElementById('strikeBtn');
            const alignLeftBtn = document.getElementById('alignLeftBtn');
            const alignCenterBtn = document.getElementById('alignCenterBtn');
            const alignRightBtn = document.getElementById('alignRightBtn');
            const alignJustifyBtn = document.getElementById('alignJustifyBtn');
            const listUlBtn = document.getElementById('listUlBtn');
            const listOlBtn = document.getElementById('listOlBtn');
            const indentBtn = document.getElementById('indentBtn');
            const outdentBtn = document.getElementById('outdentBtn');
            const linkBtn = document.getElementById('linkBtn');
            const imageBtn = document.getElementById('imageBtn');
            const tableBtn = document.getElementById('tableBtn');
            const fontColorBtn = document.getElementById('fontColorBtn');
            const bgColorBtn = document.getElementById('bgColorBtn');
            const codeBtn = document.getElementById('codeBtn');
            const clearFormatBtn = document.getElementById('clearFormatBtn');
            const undoBtn = document.getElementById('undoBtn');
            const redoBtn = document.getElementById('redoBtn');
            const formatBlock = document.getElementById('formatBlock');
            const fontColor = document.getElementById('fontColor');
            const bgColor = document.getElementById('bgColor');
            
            // Modals
            const linkModal = document.getElementById('linkModal');
            const linkText = document.getElementById('linkText');
            const linkUrl = document.getElementById('linkUrl');
            const insertLinkBtn = document.getElementById('insertLinkBtn');
            const cancelLinkBtn = document.getElementById('cancelLinkBtn');
            
            const imageModal = document.getElementById('imageModal');
            const imageUrl = document.getElementById('imageUrl');
            const imageAlt = document.getElementById('imageAlt');
            const insertImageBtn = document.getElementById('insertImageBtn');
            const cancelImageBtn = document.getElementById('cancelImageBtn');
            
            const tableModal = document.getElementById('tableModal');
            const tableRows = document.getElementById('tableRows');
            const tableCols = document.getElementById('tableCols');
            const insertTableBtn = document.getElementById('insertTableBtn');
            const cancelTableBtn = document.getElementById('cancelTableBtn');
            
            // Track editor history for undo/redo
            let undoStack = [];
            let redoStack = [];
            const maxHistorySize = 50;
            
            // Initialize with first history state
            saveHistory();
            
            // Update word and character count
            function updateWordAndCharCount() {
                const text = editor.innerText || '';
                const words = text.trim() ? text.trim().split(/\s+/).length : 0;
                const chars = text.length;
                
                wordCount.textContent = `${words} words`;
                charCount.textContent = `${chars} characters`;
            }
            
            // Save current state to history
            function saveHistory() {
                undoStack.push(editor.innerHTML);
                if (undoStack.length > maxHistorySize) {
                    undoStack.shift();
                }
                redoStack = [];
            }
            
            // Execute document command with history tracking
            function execCommand(command, value = null) {
                document.execCommand(command, false, value);
                saveHistory();
                updateWordAndCharCount();
            }
            
            // Apply or remove active class to button based on command state
            function updateButtonState(button, command) {
                if (document.queryCommandState(command)) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            }
            
            // Update all toolbar buttons state
            function updateToolbarState() {
                updateButtonState(boldBtn, 'bold');
                updateButtonState(italicBtn, 'italic');
                updateButtonState(underlineBtn, 'underline');
                updateButtonState(strikeBtn, 'strikethrough');
                updateButtonState(alignLeftBtn, 'justifyLeft');
                updateButtonState(alignCenterBtn, 'justifyCenter');
                updateButtonState(alignRightBtn, 'justifyRight');
                updateButtonState(alignJustifyBtn, 'justifyFull');
                updateButtonState(listUlBtn, 'insertUnorderedList');
                updateButtonState(listOlBtn, 'insertOrderedList');
                
                // Update formatBlock dropdown
                const formatValue = document.queryCommandValue('formatBlock');
                if (formatValue) {
                    formatBlock.value = formatValue.toLowerCase();
                }
            }
            
            // Show notification
            function showNotification(message) {
                notification.textContent = message;
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // Event listeners for buttons
            boldBtn.addEventListener('click', () => execCommand('bold'));
            italicBtn.addEventListener('click', () => execCommand('italic'));
            underlineBtn.addEventListener('click', () => execCommand('underline'));
            strikeBtn.addEventListener('click', () => execCommand('strikethrough'));
            
            alignLeftBtn.addEventListener('click', () => execCommand('justifyLeft'));
            alignCenterBtn.addEventListener('click', () => execCommand('justifyCenter'));
            alignRightBtn.addEventListener('click', () => execCommand('justifyRight'));
            alignJustifyBtn.addEventListener('click', () => execCommand('justifyFull'));
            
            listUlBtn.addEventListener('click', () => execCommand('insertUnorderedList'));
            listOlBtn.addEventListener('click', () => execCommand('insertOrderedList'));
            indentBtn.addEventListener('click', () => execCommand('indent'));
            outdentBtn.addEventListener('click', () => execCommand('outdent'));
            
            codeBtn.addEventListener('click', () => {
                const selection = window.getSelection();
                if (selection.toString()) {
                    const range = selection.getRangeAt(0);
                    const codeElement = document.createElement('code');
                    codeElement.style.fontFamily = 'monospace';
                    codeElement.style.backgroundColor = '#f5f5f5';
                    codeElement.style.padding = '2px 4px';
                    codeElement.style.borderRadius = '3px';
                    range.surroundContents(codeElement);
                    saveHistory();
                }
            });
            
            clearFormatBtn.addEventListener('click', () => execCommand('removeFormat'));
            
            // Format block dropdown
            formatBlock.addEventListener('change', () => {
                execCommand('formatBlock', `<${formatBlock.value}>`);
            });
            
            // Color pickers
            fontColor.addEventListener('input', () => {
                execCommand('foreColor', fontColor.value);
            });
            
            bgColor.addEventListener('input', () => {
                execCommand('hiliteColor', bgColor.value);
            });
            
            // Undo/Redo functionality
            undoBtn.addEventListener('click', () => {
                if (undoStack.length > 1) {
                    redoStack.push(undoStack.pop()); // Move current state to redo stack
                    editor.innerHTML = undoStack[undoStack.length - 1]; // Set to previous state
                    updateWordAndCharCount();
                }
            });
            
            redoBtn.addEventListener('click', () => {
                if (redoStack.length > 0) {
                    const state = redoStack.pop();
                    undoStack.push(state);
                    editor.innerHTML = state;
                    updateWordAndCharCount();
                }
            });
            
            // Link functionality
            linkBtn.addEventListener('click', () => {
                const selection = window.getSelection();
                if (selection.toString()) {
                    linkText.value = selection.toString();
                    linkUrl.value = 'https://';
                    linkModal.style.display = 'flex';
                } else {
                    showNotification('Please select text to create a link');
                }
            });
            
            insertLinkBtn.addEventListener('click', () => {
                if (linkUrl.value) {
                    execCommand('createLink', linkUrl.value);
                    const links = editor.querySelectorAll('a[href="' + linkUrl.value + '"]');
                    links.forEach(link => {
                        if (linkText.value && link.textContent !== linkText.value) {
                            link.textContent = linkText.value;
                        }
                        link.target = '_blank';
                    });
                    linkModal.style.display = 'none';
                    saveHistory();
                }
            });
            
            cancelLinkBtn.addEventListener('click', () => {
                linkModal.style.display = 'none';
            });
            
            // Image functionality
            imageBtn.addEventListener('click', () => {
                imageUrl.value = 'https://';
                imageAlt.value = '';
                imageModal.style.display = 'flex';
            });
            
            insertImageBtn.addEventListener('click', () => {
                if (imageUrl.value) {
                    const img = `<img src="${imageUrl.value}" alt="${imageAlt.value}" style="max-width: 100%;">`;
                    execCommand('insertHTML', img);
                    imageModal.style.display = 'none';
                }
            });
            
            cancelImageBtn.addEventListener('click', () => {
                imageModal.style.display = 'none';
            });
            
            // Table functionality
            tableBtn.addEventListener('click', () => {
                tableModal.style.display = 'flex';
            });
            
            insertTableBtn.addEventListener('click', () => {
                const rows = parseInt(tableRows.value) || 3;
                const cols = parseInt(tableCols.value) || 3;
                
                let tableHTML = '<table style="width:100%; border-collapse: collapse;">';
                
                // Create header row
                tableHTML += '<thead><tr>';
                for (let i = 0; i < cols; i++) {
                    tableHTML += `<th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Header ${i+1}</th>`;
                }
                tableHTML += '</tr></thead><tbody>';
                
                // Create data rows
                for (let i = 0; i < rows - 1; i++) {
                    tableHTML += '<tr>';
                    for (let j = 0; j < cols; j++) {
                        tableHTML += `<td style="border: 1px solid #ddd; padding: 8px;">Cell ${i+1}-${j+1}</td>`;
                    }
                    tableHTML += '</tr>';
                }
                
                tableHTML += '</tbody></table><p></p>';
                
                execCommand('insertHTML', tableHTML);
                tableModal.style.display = 'none';
            });
            
            cancelTableBtn.addEventListener('click', () => {
                tableModal.style.display = 'none';
            });
            
            // Editor change events
            editor.addEventListener('input', () => {
                updateWordAndCharCount();
                saveHistory();
            });
            
            editor.addEventListener('click', updateToolbarState);
            editor.addEventListener('keyup', updateToolbarState);
            
            // Save functionality
            saveBtn.addEventListener('click', () => {
                const content = editor.innerHTML;
                const blob = new Blob([content], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName.value || 'document.html';
                a.click();
                
                URL.revokeObjectURL(url);
                showNotification('Document saved successfully!');
            });
            
            // Print functionality
            printBtn.addEventListener('click', () => {
                window.print();
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === linkModal) linkModal.style.display = 'none';
                if (e.target === imageModal) imageModal.style.display = 'none';
                if (e.target === tableModal) tableModal.style.display = 'none';
            });
            
            // Initial update
            updateWordAndCharCount();
        });
    </script>
</body>
</html>
